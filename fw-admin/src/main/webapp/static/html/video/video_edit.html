<!-- Content Header (Page header) -->
<section class="content-header">
    <h1 id="itemTitle"></h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#" id="backList">视频列表</a></li>
        <li class="active" id="videoName"></li>
    </ol>
</section>
<!-- .content -->
<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-info">
                <div class="box-header">
                    <!-- tools box -->
                    <div class="pull-right box-tools">
                        <button type="button" class="btn btn-default btn-sm" data-widget="collapse"
                                data-toggle="tooltip" title="Collapse">
                            <i class="fa fa-minus"></i></button>
                    </div>
                    <!-- /. tools -->
                </div>
                <!-- /.box-header -->
                <div class="box-body pad">
                    <form id="videoForm">
                        <input type="hidden" name='id' id="id" value="0">
                        <input type="hidden" name='rating' id="rating" value="0">
                        <input type="hidden" name='isEdit' id="isEdit">

                        <div class="form-group">
                            <label for="title" class="control-label">标题:</label>
                            <input type="text" class="form-control validate[required]" name="title" id="title">
                            <a class="btn btn-warning pull-right" id="sync">同步</a>
                        </div>
                        <div class="form-group">
                            <label for="alias" class="control-label">别名:</label>
                            <input type="text" class="form-control validate[required]" name="alias" id="alias">
                            <a href="" target="_blank" class="sourceLinkId">点击查看源地址</a>
                        </div>
                        <div class="form-group">
                            <label for="type" class="control-label">视频类型:</label>
                            <select name="type" id="type" data-btn-class="btn-warning">
                            </select>
                            <span style="color:red;" >*</span>
                            <span id="typeId"></span>
                        </div>
                        <div class="form-group">
                            <label for="poster" class="control-label">海报（图片较大）:</label>
                            <input type="text" class="form-control" name="poster" id="poster">
                        </div>
                        <div class="form-group">
                            <label for="cover" class="control-label">海报（图片较小）:</label>
                            <input type="text" class="form-control" name="cover" id="cover">
                        </div>
                        <div class="form-group">
                            <label for="director" class="control-label">导演:</label>
                            <input type="text" class="form-control validate[required]" name="director" id="director">
                        </div>
                        <div class="form-group">
                            <label for="actors" class="control-label">演员(多个用逗号分隔):</label>
                            <input type="text" class="form-control validate[required]" name="actors" id="actors">
                        </div>
                        <div class="form-group">
                            <label for="released" class="control-label">上映日期:</label>
                            <input type="text" class="form-control validate[required]" id="released" name="released">

                            <p class="tbar">
                                <span class="label label-success">2016</span>
                                <span class="label label-success">2015</span>
                                <span class="label label-success">2014</span>
                                <span class="label label-success">2013</span>
                                <span class="label label-success">2012</span>
                                <span class="label label-success">2011</span>
                                <span class="label label-success">2010</span>
                                <span class="label label-success">2009</span>
                                <span class="label label-success">2008</span>
                                <span class="label label-success">2007</span>
                                <span class="label label-success">2006</span>
                                <span class="label label-success">2005</span>
                                <span class="label label-success">2003</span>
                                <span class="label label-success">2002</span>
                                <span class="label label-success">2001</span>
                                <span class="label label-success">2000</span>
                                <span class="label label-success">1999</span>
                                <span class="label label-success">1998</span>
                                <span class="label label-success">1997</span>
                                <span class="label label-success">1996</span>
                                <span class="label label-success">1995</span>
                                <span class="label label-success">1994</span>
                                <span class="label label-success">1993</span>
                                <span class="label label-success">1992</span>
                                <span class="label label-success">1991</span>
                                <span class="label label-success">1990</span>
                            </p>
                        </div>
                        <div class="form-group">
                            <label for="country" class="control-label">国家(地区):</label>
                            <input type="text" class="form-control validate[required]" name="country" id="country">

                            <p class="tbar">
                                <span class="label label-success">中国</span>
                                <span class="label label-success">美国</span>
                                <span class="label label-success">英国</span>
                                <span class="label label-success">法国</span>
                                <span class="label label-success">韩国</span>
                                <span class="label label-success">德国</span>
                                <span class="label label-success">日本</span>
                                <span class="label label-success">印度</span>
                                <span class="label label-success">加拿大</span>
                                <span class="label label-success">意大利</span>
                                <span class="label label-success">西班牙</span>
                                <span class="label label-success">澳大利亚</span>
                                <span class="label label-success">泰国</span>
                            </p>
                        </div>
                        <div class="form-group">
                            <label for="language" class="control-label">语言:</label>
                            <input type="text" class="form-control" name="language" id="language">

                            <p class="tbar">
                                <span class="label label-success">国语</span>
                                <span class="label label-success">粤语</span>
                                <span class="label label-success">国粤语</span>
                                <span class="label label-success">英语</span>
                                <span class="label label-success">法语</span>
                                <span class="label label-success">韩语</span>
                                <span class="label label-success">日语</span>
                                <span class="label label-success">泰语</span>
                                <span class="label label-success">西班牙语</span>
                                <span class="label label-success">意大利语</span>
                            </p>
                        </div>
                        <div class="form-group">
                            <label for="duration" class="control-label">时长(分钟):</label>
                            <input type="text" class="form-control validate[required]" name="duration" id="duration">
                            <p class="tbar">
                                <span class="label label-success">132</span>
                                <span class="label label-success">124</span>
                                <span class="label label-success">120</span>
                                <span class="label label-success">114</span>
                                <span class="label label-success">112</span>
                                <span class="label label-success">110</span>
                                <span class="label label-success">109</span>
                                <span class="label label-success">108</span>
                                <span class="label label-success">107</span>
                                <span class="label label-success">106</span>
                                <span class="label label-success">105</span>
                                <span class="label label-success">104</span>
                                <span class="label label-success">103</span>
                                <span class="label label-success">102</span>
                                <span class="label label-success">101</span>
                                <span class="label label-success">100</span>
                                <span class="label label-success">98</span>
                                <span class="label label-success">97</span>
                                <span class="label label-success">96</span>
                                <span class="label label-success">95</span>
                                <span class="label label-success">93</span>
                                <span class="label label-success">92</span>
                                <span class="label label-success">91</span>
                                <span class="label label-success">90</span>
                                <span class="label label-success">88</span>
                                <span class="label label-success">87</span>
                                <span class="label label-success">86</span>
                                <span class="label label-success">85</span>
                                <span class="label label-success">84</span>
                                <span class="label label-success">83</span>
                                <span class="label label-success">82</span>
                                <span class="label label-success">81</span>
                            </p>
                            <a href="" target="_blank" class="sourceLinkId">点击查看源地址</a>
                        </div>
                        <div class="form-group">
                            <label for="qrcode" class="control-label">二维码:</label>
                            <input type="text" class="form-control" name="qrcode" id="qrcode">
                        </div>
                        <div class="form-group">
                            <label for="scanTime" class="control-label">浏览次数:</label>
                            <input type="text" class="form-control" name="scanTime" id="scanTime">
                            <p class="tbar">
                                <span class="label label-success">5529</span>
                                <span class="label label-success">5418</span>
                                <span class="label label-success">5336</span>
                                <span class="label label-success">4612</span>
                                <span class="label label-success">4388</span>
                                <span class="label label-success">4218</span>
                                <span class="label label-success">3720</span>
                                <span class="label label-success">3350</span>
                                <span class="label label-success">3240</span>
                                <span class="label label-success">2830</span>
                                <span class="label label-success">2531</span>
                                <span class="label label-success">2102</span>
                                <span class="label label-success">1892</span>
                                <span class="label label-success">1503</span>
                                <span class="label label-success">952</span>
                                <span class="label label-success">880</span>
                                <span class="label label-success">612</span>
                                <span class="label label-success">325</span>
                                <span class="label label-success">180</span>
                            </p>
                        </div>
                        <div class="form-group">
                            <label for="likeTime" class="control-label">喜欢次数:</label>
                            <input type="text" class="form-control" name="likeTime" id="likeTime">
                            <p class="tbar">
                                <span class="label label-success">250</span>
                                <span class="label label-success">536</span>
                                <span class="label label-success">892</span>
                                <span class="label label-success">503</span>
                                <span class="label label-success">806</span>
                                <span class="label label-success">233</span>
                                <span class="label label-success">212</span>
                                <span class="label label-success">116</span>
                                <span class="label label-success">113</span>
                                <span class="label label-success">104</span>
                                <span class="label label-success">103</span>
                                <span class="label label-success">102</span>
                                <span class="label label-success">92</span>
                                <span class="label label-success">71</span>
                                <span class="label label-success">63</span>
                                <span class="label label-success">80</span>
                                <span class="label label-success">10</span>
                                <span class="label label-success">6</span>
                            </p>
                        </div>
                        <div class="form-group">
                            <label for="info2" class="control-label">简介:</label>
                        </div>
                        <textarea class="textarea" placeholder="填写视频简介" name="info" id="info2"
                                  style="width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;"></textarea>
                        <a href="" target="_blank" class="sourceLinkId">点击查看源地址</a>
                        <div class="form-group">
                            <label for="resourceLink" class="control-label">资源地址:</label>
                            <textarea class="textarea" id="resourceLink" disabled="disabled"
                                      style="width: 100%; height: 80px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;"></textarea>
                        </div>
                    </form>
                </div>
                <!-- ./box-body -->
                <div class="box-footer">
                    <button type="reset" class="btn btn-default">重置</button>
                    <button type="submit" class="btn btn-primary pull-right" id="save">保存</button>
                </div>
                <!-- /.box-footer -->
            </div>
        </div>
        <!-- /.col-->
    </div>
    <!-- ./row -->
    </form>
    <div class="modal fade" id="tipModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">提示信息</h4>
                </div>
                <div class="modal-body" id="tipMsg"></div>
            </div>
        </div>
    </div>
</section>
<!-- .content -->
<script>
    var isEdit = false;
    var syncTime = 1;
    $(function () {
        // 点击视频列表返回
        $("#backList").click(function () {
            backToVideoList();
        });

        // 构建下拉组合框
        ComboboxHelper.build('/admin/getVideoType.action', '#type');
        // 检验初始化
        $("#videoForm").validationEngine();
        $("#save").click(function () {
            if ($("#videoForm").validationEngine('validate')) {
                $.ajax({
                    type: 'post',
                    url: '/admin/saveResVideo.action?isEdit=true',
                    data: $('#videoForm').serialize(),
                    dataType: 'json',
                    success: function (json) {
                        if (json.result == 1) {
                            alert("保存成功");
                            backToVideoList();
                        } else {
                            $("#tipMsg").text("保存失败，错误码：" + json.result);
                            $("#tipModal").modal('show');
                        }
                    }
                })
            }
        });
    });
    //返回视频列表
    function backToVideoList() {
        $.ajax({
            url: '/html/video/video_admin.html',
            dataType: "html",
            success: function (html) {
                $("#content").html(html);
                $("#itemTitle").text("视频管理");
            },
            error: function (data) {
                $("#content").html("<h3>404&nbsp;&nbsp;The page can not found.</h3>" + data);
            }
        });
    };

    $('#sync').click(function () {
        $.ajax({
            type: 'post',
            dataType: 'json',
            data: {'title': $('#title').val().trim(),'time':syncTime},
            url: '/admin/searchDouban.action',
            success: function (json) {
                if(json) {
                    $("#sync").text("同步 "+(syncTime++)+" 次");
                    $('#alias').val(json.aka);
                    $('#cover').val(json.cover);
                    $('#poster').val(json.poster);
                    $('#released').val(json.released);
                    $('#rating').val(json.rating);
                    $('#director').val(json.director);
                    $('#actors').val(json.actors);
                    $('#typeId').text(json.genres);
                    $('#country').val(json.countries);

                    $('#duration').val(json.duration);
                    $('#language').val(json.language);
                    $("#info2").empty();
                    $("#info2").wysihtml5();
                    $('#info2').val(json.info);
                }else{
                    $('#rating').val("0");
                }

            }
        });
    });

    $('.tbar span').click(function () {
        console.log($(this).text());
        $(this).parent().prev().val($(this).text());
    });

</script>
